@{
    ViewBag.Title = "MyCourseLlist";

    var account = "";
    if (Session["sIDNo"] == null || string.IsNullOrWhiteSpace(Session["sIDNo"].ToString()))
    {
        Response.Redirect("../Home/Index");
    }
    else
    {
        account = Session["sIDNo"].ToString();
    }

    //沒使用_ViewStart就要自訂Layout位置
    //Layout = "~/Views/Shared/_UserInfoLayout.cshtml";
    <link rel="stylesheet" href="~/Content/jquery.dataTables.min.css" />
    <script type="text/javascript" src="~/Scripts/jquery.dataTables.min.js"></script>
}


<style>
    .portlet.box.blue {
        border: 1px solid #60aee4;
        border-top: 0;
    }

        .portlet.blue, .portlet.box.blue > .portlet-title, .portlet > .portlet-body.blue {
            background-color: #3598dc;
        }

    .portlet.box {
        padding: 0 !important;
    }

    .portlet {
        margin-top: 0;
        margin-bottom: 25px;
        padding: 0;
        border-radius: 4px;
    }

        .portlet.box > .portlet-title {
            border-bottom: 0;
            padding: 10px;
            margin-bottom: 0;
            color: #fff;
        }

        .portlet.box > .portlet-body {
            background-color: #fff;
            padding: 15px;
        }
</style>



<br />
<div class="form-horizontal" ng-app="app">
    <div ng-controller="MyCourseLlist as vm">
        <h4>我的選課清單</h4>
        <hr />
        <div class="portlet box blue">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-gift"></i><label style="font-size:18px">查詢條件</label>
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title=""></a>

                </div>
            </div>
            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                <form action="#" class="form-horizontal">
                    <div class="form-body">
                        <div class="form-group">
                            <h4><label class="col-md-2 control-label">開課學年：</label></h4>
                        </div>
                        <div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">學年</label>
                                <div class="col-md-10" id="">
                                    <select ng-model="schoolYear" ng-options=" member for member in schoolYears" class="form-control "></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">學期</label>
                                <div class="col-md-10" id="">
                                    <select ng-model="semester" ng-options=" member for member in semesters" class="form-control "></select>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="form-actions fluid">
                        <div class="row">
                            <div class="col-md-offset-3 col-md-9">

                                <button type="button" class="btn btn-primary" ng-click="vm.search()">搜尋</button>

                            </div>
                        </div>
                    </div>

                </form>
            </div>
        </div>

        <!-- Main content -->
        <section class="content container-fluid">
            <div class="box">
                <div>
                    <table class="table table-striped table-hover" id="myDataTalbe">
                        <thead>
                            <tr>
                                <th width="100px">課名<br><span style="font-size:0.9em">Course title</span></th>
                                <th width="50px">開課碼<br><span style="font-size:0.9em">Course<br>Number</span></th>
                                <th width="35px">學分<br><span style="font-size:0.9em">Credits</span></th>
                                <th width="110px">開課學年<br><span style="font-size:0.9em">Class Year</span></th>
                                <th width="110px">開課系級<br><span style="font-size:0.9em">Grade &amp; Class</span></th>
                                <th width="35px">選必修<br><span style="font-size:0.8em">Required<br>/ Elective</span></th>
                                <th width="200px">時間地點<br><span style="font-size:0.9em">Time and location</span></th>
                                <th width="60px">教師<br><span style="font-size:0.9em">Instructor</span></th>
                                <th width="33px">課綱<br><span style="font-size:0.9em">Syllabus</span></th>
                                <th width="33px">人數上限<br><span style="font-size:0.9em">Syllabus</span></th>
                                <th width="33px">目前人數<br><span style="font-size:0.9em">Syllabus</span></th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th width="100px">課名<br><span style="font-size:0.9em">Course title</span></th>
                                <th width="50px">開課碼<br><span style="font-size:0.9em">Course<br>Number</span></th>
                                <th width="35px">學分<br><span style="font-size:0.9em">Credits</span></th>
                                <th width="110px">開課學年<br><span style="font-size:0.9em">Class Year</span></th>
                                <th width="110px">開課系級<br><span style="font-size:0.9em">Grade &amp; Class</span></th>
                                <th width="35px">選必修<br><span style="font-size:0.8em">Required<br>/ Elective</span></th>
                                <th width="150px">時間地點<br><span style="font-size:0.9em">Time and location</span></th>
                                <th width="60px">教師<br><span style="font-size:0.9em">Instructor</span></th>
                                <th width="33px">課綱<br><span style="font-size:0.9em">Syllabus</span></th>
                                <th width="33px">人數上限<br><span style="font-size:0.9em">Syllabus</span></th>
                                <th width="33px">目前人數<br><span style="font-size:0.9em">Syllabus</span></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>


        </section>

        <div class="portlet box green" id="div_searchTable">
            <div class="portlet-title">

            </div>
            <div class="portlet-body">
                <div id="printArea" style="width: 100%; text-align: left;">
                    <div class="clearfix"></div>
                    <div class="form-horizontal">
                        <div class="form-group">

                        </div>
                    </div>
                    <div id="div_tab1" class="">
                        <div id="searchTable_wrapper" class="dataTables_wrapper no-footer">
                            <div class="row"><div class="col-md-6 col-sm-6"></div><div class="col-md-6 col-sm-6"></div></div><div class="table-scrollable">
                                <table class="table table-striped table-bordered table-hover table-checkable order-column dataTable no-footer" id="searchTable" role="grid">
                                    <thead>
                                        <tr role="row"><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 3%;">學期別</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 3%;">節次</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 5%;">平日</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 10%;">星期一</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 10%;">星期二</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 10%;">星期三</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 10%;">星期四</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 10%;">星期五</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 10%;">星期六</th><th class="sorting_disabled" rowspan="1" colspan="1" style="width: 10%;">星期日</th></tr>
                                    </thead>
                                    <tbody>
                                        <tr role="row" class="odd" ng-repeat="schedule in schedules">
                                            <td>{{schedule.SchoolSemester}}</td>
                                            <td>第{{schedule.ClassPeriod}}節</td>
                                            <td><center>{{schedule.Time}}</center></td>
                                            <td><center>{{schedule.SubjectNumber1}}<br>{{schedule.Subject1}}<br>{{schedule.SchoolNumber1}}</center></td>
                                            <td><center>{{schedule.SubjectNumber2}}<br>{{schedule.Subject2}}<br>{{schedule.SchoolNumber2}}</center></td>
                                            <td><center>{{schedule.SubjectNumber3}}<br>{{schedule.Subject3}}<br>{{schedule.SchoolNumber3}}</center></td>
                                            <td><center>{{schedule.SubjectNumber4}}<br>{{schedule.Subject4}}<br>{{schedule.SchoolNumber4}}</center></td>
                                            <td><center>{{schedule.SubjectNumber5}}<br>{{schedule.Subject5}}<br>{{schedule.SchoolNumber5}}</center></td>
                                            <td><center>{{schedule.SubjectNumber6}}<br>{{schedule.Subject6}}<br>{{schedule.SchoolNumber6}}</center></td>
                                            <td><center>{{schedule.SubjectNumber7}}<br>{{schedule.Subject7}}<br>{{schedule.SchoolNumber7}}</center></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div><div class="row"><div class="col-md-5 col-sm-5"></div><div class="col-md-7 col-sm-7"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">

    var appModule = angular.module('app', []);
    appModule.controller('MyCourseLlist', ['$scope', '$http', function ($scope, $http) {
        var vm = this;

        $scope.schoolYears = [];
        $scope.semesters = ["第一學期", "第二學期"];
        $scope.schedules = {};

        function initial() {
            $http({

                method: 'POST',
                url: "/MyCourseLlist/GetMyCourseLlist",
                data: null,
                dataType: 'json',

            }).then(function Callback(response) {

                if (response.data.error == false) {
                    sweetAlert(response.data.message, '', 'error');
                }
                else {
                    for (var i = 90; i <= response.data.schoolYear; i++) {
                        //從2011開始
                        $scope.schoolYears.push(i);
                    }

                    $scope.schoolYear = response.data.schoolYear;
                    $scope.semester = response.data.semester;
                    $scope.schedules = response.data.schedules;

                    $("#myDataTalbe").DataTable({
                        searching: false, //關閉filter功能
                        data: response.data.courseInQuiryInfos,
                        order: [[1, "asc"]],
                        columnDefs: [{
                            targets: [3],
                            orderable: false,
                        }],
                        destroy: true, //Cannot reinitialise DataTable,解决重新加载表格内容问题,
                        columns: [
                            { data: "Subject" },
                            { data: "SubjectNumber" },
                            { data: "Credits" },
                            { data: "ClassYear" },
                            { data: "GradeClass" },
                            { data: "RequiredElective" },
                            { data: "TimeLocation" },
                            { data: "Instructor" },
                            {
                                data: "", render: function (data, type, row) {
                                    var yearSemesters = $scope.schoolYear + " " + $scope.semester;
                                    return '<a target="_blank" href="/CourseInQuiry/Syllabus?yearSemesters=' + yearSemesters + '&courseID=' + row.CourseID
                                        + '&applicationUserId=' + row.ApplicationUserId + '&gradeClass=' + row.GradeClass
                                        + '&requiredElective=' + row.RequiredElective
                                        + '&timeLocation=' + row.TimeLocation + '&maximumNum=' + row.MaximumNum
                                        + ' "><img style="width:40px" src="../Images/file.png" /></a>';
                                }
                            },
                            { data: "MaximumNum" },
                            { data: "CurrentNum" }
                        ]

                    });




                }
            });
        }

        vm.search = function () {

            $http({

                method: 'POST',
                url: "/MyCourseLlist/MyCourseLlistSearch",
                data: { schoolYear: $scope.schoolYear, semester: $scope.semester },
                dataType: 'json',

            }).then(function Callback(response) {

                if (response.data.error == false) {
                    sweetAlert(response.data.message, '', 'error');
                }
                else {

                    $scope.schedules = response.data.schedules;

                    $("#myDataTalbe").DataTable({
                        searching: false, //關閉filter功能
                        data: response.data.courseInQuiryInfos,
                        order: [[1, "asc"]],
                        columnDefs: [{
                            targets: [3],
                            orderable: false,
                        }],
                        destroy: true, //Cannot reinitialise DataTable,解决重新加载表格内容问题,
                        columns: [
                            { data: "Subject" },
                            { data: "SubjectNumber" },
                            { data: "Credits" },
                            { data: "ClassYear" },
                            { data: "GradeClass" },
                            { data: "RequiredElective" },
                            { data: "TimeLocation" },
                            { data: "Instructor" },
                            {
                                data: "", render: function (data, type, row) {
                                    var yearSemesters = $scope.schoolYear + " " + $scope.semester;
                                    return '<a target="_blank" href="/CourseInQuiry/Syllabus?yearSemesters=' + yearSemesters + '&courseID=' + row.CourseID
                                        + '&applicationUserId=' + row.ApplicationUserId + '&gradeClass=' + row.GradeClass
                                        + '&requiredElective=' + row.RequiredElective
                                        + '&timeLocation=' + row.TimeLocation + '&maximumNum=' + row.MaximumNum
                                        + ' "><img style="width:40px" src="../Images/file.png" /></a>';
                                }
                            },
                            { data: "MaximumNum" },
                            { data: "CurrentNum" }
                        ]

                    });
                }
            });
        }

        initial();

    }]);
</script>